<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>만세력 (상세 테이블)</title>
    <style>
        :root {
            --bg-color: #f5f5f7;
            --card-bg: #ffffff;
            --border-color: #e0e0e0;
            --header-bg: #f0f2f5;
            --primary-color: #0071e3;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Pretendard", "Apple SD Gothic Neo", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background-color: var(--card-bg);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 800px;
        }

        h1 {
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            color: #333;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        input[type="datetime-local"] {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
        }

        button {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
        }
        button:hover { background-color: #0077ed; }

        /* 테이블 스타일 */
        .saju-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            text-align: center;
            table-layout: fixed;
            font-size: 0.95rem;
        }

        .saju-table th, .saju-table td {
            border: 1px solid var(--border-color);
            padding: 8px 4px; /* 패딩 약간 줄임 */
            vertical-align: middle;
        }

        .saju-table th {
            background-color: var(--header-bg);
            font-weight: 600;
            color: #555;
            height: 40px;
        }

        /* 첫 번째 열 (헤더) 스타일 */
        .row-header {
            background-color: #fafafa;
            font-weight: bold;
            width: 90px; /* 글씨가 길어져서 너비 조금 늘림 */
            color: #333;
            font-size: 0.85rem;
            word-break: keep-all; /* 단어 끊기 방지 */
        }

        /* 글자 박스 (천간/지지) */
        .char-box {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            font-size: 1.4rem;
            font-weight: bold;
            color: white;
            margin-bottom: 2px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .char-ko {
            font-size: 0.85rem;
            font-weight: bold;
            color: #555;
            display: block;
        }

        /* 십성 텍스트 */
        .ten-god-text {
            font-size: 0.9rem;
            font-weight: 600;
            color: #444;
            background-color: #f5f5f5;
            padding: 3px 6px;
            border-radius: 4px;
            display: inline-block;
        }

        /* 본원 강조 */
        .master-label {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* 신살/귀인 배지 */
        .badge {
            display: inline-block;
            font-size: 0.75rem;
            padding: 2px 5px;
            border-radius: 4px;
            margin: 1px;
            line-height: 1.3;
        }
        .badge-sinsal { background-color: #fff0f0; color: #d32f2f; border: 1px solid #ffcdd2; }
        .badge-noble { background-color: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }

        /* 오행 색상 */
        .bg-wood { background-color: #4CAF50; }
        .bg-fire { background-color: #F44336; }
        .bg-earth { background-color: #FFD600; color: #333 !important; }
        .bg-metal { background-color: #90A4AE; }
        .bg-water { background-color: #2196F3; }
        
        /* 모바일 대응 */
        @media (max-width: 600px) {
            .container { padding: 1rem; }
            .char-box { width: 35px; height: 35px; font-size: 1.1rem; }
            .saju-table { font-size: 0.8rem; }
            .row-header { width: 70px; font-size: 0.75rem; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>만세력 (상세 분석)</h1>
    
    <div class="input-group">
        <input type="datetime-local" id="birthDate">
        <button onclick="calculateSaju()">분석하기</button>
    </div>

    <div id="resultArea" style="display:none;">
        <table class="saju-table">
            <thead>
                <tr>
                    <th class="row-header">구분</th>
                    <th>년주 (Year)</th>
                    <th>월주 (Month)</th>
                    <th>일주 (Day)</th>
                    <th>시주 (Time)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="row-header">천간</td>
                    <td id="yearSkyCell"></td>
                    <td id="monthSkyCell"></td>
                    <td id="daySkyCell"></td>
                    <td id="hourSkyCell"></td>
                </tr>
                <tr>
                    <td class="row-header">천간 십성</td>
                    <td id="yearSkyTen"></td>
                    <td id="monthSkyTen"></td>
                    <td id="daySkyTen"></td> <td id="hourSkyTen"></td>
                </tr>
                
                <tr>
                    <td class="row-header">지지</td>
                    <td id="yearGroundCell"></td>
                    <td id="monthGroundCell"></td>
                    <td id="dayGroundCell"></td>
                    <td id="hourGroundCell"></td>
                </tr>
                <tr>
                    <td class="row-header">지지 십성</td>
                    <td id="yearGroundTen"></td>
                    <td id="monthGroundTen"></td>
                    <td id="dayGroundTen"></td>
                    <td id="hourGroundTen"></td>
                </tr>

                <tr>
                    <td class="row-header">십이운성</td>
                    <td id="yearUnseong"></td>
                    <td id="monthUnseong"></td>
                    <td id="dayUnseong"></td>
                    <td id="hourUnseong"></td>
                </tr>
                <tr>
                    <td class="row-header">신살</td>
                    <td id="yearSinsal"></td>
                    <td id="monthSinsal"></td>
                    <td id="daySinsal"></td>
                    <td id="hourSinsal"></td>
                </tr>
                <tr>
                    <td class="row-header">귀인</td>
                    <td id="yearNoble"></td>
                    <td id="monthNoble"></td>
                    <td id="dayNoble"></td>
                    <td id="hourNoble"></td>
                </tr>
            </tbody>
        </table>
        
        <div style="margin-top: 20px; font-size: 0.8rem; color: #666; text-align: center; line-height: 1.5;">
            * <b>천간 십성</b>: 일간(나)과 천간 글자 간의 관계<br>
            * <b>지지 십성</b>: 일간(나)과 지지 정기(본기) 간의 관계<br>
            * 2024년 1월 1일(갑자) 기준 역산 / 야자시 적용(23:30 이후 다음날 자시)
        </div>
    </div>
</div>

<script>
    // ==========================================
    // 1. 데이터 정의
    // ==========================================
    const WUXING = [
        { name: '목', color: 'bg-wood' },
        { name: '화', color: 'bg-fire' },
        { name: '토', color: 'bg-earth' },
        { name: '금', color: 'bg-metal' },
        { name: '수', color: 'bg-water' }
    ];

    const TEN_GODS = {
        0: ['비견', '겁재'],
        1: ['식신', '상관'],
        2: ['편재', '정재'],
        3: ['편관', '정관'],
        4: ['편인', '정인']
    };

    const UNSEONG_NAMES = ["장생", "목욕", "관대", "건록", "제왕", "쇠", "병", "사", "묘", "절", "태", "양"];

    const SKY_DATA = [
        { idx:0, ch:'甲', ko:'갑', wuxingIdx:0, yinYang:0 },
        { idx:1, ch:'乙', ko:'을', wuxingIdx:0, yinYang:1 },
        { idx:2, ch:'丙', ko:'병', wuxingIdx:1, yinYang:0 },
        { idx:3, ch:'丁', ko:'정', wuxingIdx:1, yinYang:1 },
        { idx:4, ch:'戊', ko:'무', wuxingIdx:2, yinYang:0 },
        { idx:5, ch:'己', ko:'기', wuxingIdx:2, yinYang:1 },
        { idx:6, ch:'庚', ko:'경', wuxingIdx:3, yinYang:0 },
        { idx:7, ch:'辛', ko:'신', wuxingIdx:3, yinYang:1 },
        { idx:8, ch:'壬', ko:'임', wuxingIdx:4, yinYang:0 },
        { idx:9, ch:'癸', ko:'계', wuxingIdx:4, yinYang:1 }
    ];

    // 지지 데이터 (isYang: 십성 계산용 음양, 실제 체와 다를 수 있음. 자수는 음수 취급 등)
    const GROUND_DATA = [
        { idx:0,  ch:'子', ko:'자', wuxingIdx:4, isYang: false }, // 자(음수)
        { idx:1,  ch:'丑', ko:'축', wuxingIdx:2, isYang: false }, // 축(음토)
        { idx:2,  ch:'寅', ko:'인', wuxingIdx:0, isYang: true },  // 인(양목)
        { idx:3,  ch:'卯', ko:'묘', wuxingIdx:0, isYang: false }, // 묘(음목)
        { idx:4,  ch:'辰', ko:'진', wuxingIdx:2, isYang: true },  // 진(양토)
        { idx:5,  ch:'巳', ko:'사', wuxingIdx:1, isYang: true },  // 사(양화)
        { idx:6,  ch:'午', ko:'오', wuxingIdx:1, isYang: false }, // 오(음화)
        { idx:7,  ch:'未', ko:'미', wuxingIdx:2, isYang: false }, // 미(음토)
        { idx:8,  ch:'申', ko:'신', wuxingIdx:3, isYang: true },  // 신(양금)
        { idx:9,  ch:'酉', ko:'유', wuxingIdx:3, isYang: false }, // 유(음금)
        { idx:10, ch:'戌', ko:'술', wuxingIdx:2, isYang: true },  // 술(양토)
        { idx:11, ch:'亥', ko:'해', wuxingIdx:4, isYang: true },  // 해(양수)
    ];
    
    const SOLAR_TERMS = { 2:4, 3:6, 4:5, 5:6, 6:6, 7:7, 8:8, 9:8, 10:8, 11:7, 12:7, 1:6 };

    // ==========================================
    // 2. 계산 로직
    // ==========================================
    function mod(n, m) { return ((n % m) + m) % m; }

    function calculateSaju() {
        const inputStr = document.getElementById('birthDate').value;
        if (!inputStr) return alert("날짜를 선택하세요.");

        const dateObj = new Date(inputStr);
        const year = dateObj.getFullYear();
        const month = dateObj.getMonth() + 1;
        const day = dateObj.getDate();
        const hour = dateObj.getHours();
        const minute = dateObj.getMinutes();

        // 1. 년주
        const ipchunDay = SOLAR_TERMS[2];
        let isBeforeIpchun = (month < 2) || (month === 2 && day < ipchunDay);
        let sajuYear = isBeforeIpchun ? year - 1 : year;
        
        let yearSkyIdx = mod(sajuYear - 4, 10);
        let yearGroundIdx = mod(sajuYear - 4, 12);

        // 2. 월주
        const termDay = SOLAR_TERMS[month];
        let sajuMonthNum = (day < termDay) ? month - 1 : month;
        if (sajuMonthNum < 1) sajuMonthNum = 12;
        
        let monthGroundIdx;
        if (sajuMonthNum === 12) monthGroundIdx = 0; // 자
        else if (sajuMonthNum === 1) monthGroundIdx = 1; // 축
        else monthGroundIdx = sajuMonthNum; 

        let startMonthSkyIdx = (yearSkyIdx % 5) * 2 + 2;
        let monthsPassed = mod(monthGroundIdx - 2, 12);
        let monthSkyIdx = mod(startMonthSkyIdx + monthsPassed, 10);

        // 3. 일주
        const refDate = new Date(2024, 0, 1);
        const targetDate = new Date(year, month - 1, day);
        const diffDays = Math.floor((targetDate - refDate) / (86400000));
        let dayGanjiIdx = mod(diffDays, 60);
        let daySkyIdx = dayGanjiIdx % 10;
        let dayGroundIdx = dayGanjiIdx % 12;

        // 4. 시주
        let timeVal = hour + (minute / 60.0);
        let hourGroundIdx = (timeVal >= 23.5) ? 0 : Math.floor((timeVal + 0.5) / 2) % 12;
        let startHourSkyIdx = (daySkyIdx % 5) * 2;
        let hourSkyIdx = mod(startHourSkyIdx + hourGroundIdx, 10);

        // 데이터 패키징
        const dayMaster = SKY_DATA[daySkyIdx];
        const pillars = {
            year: { s: yearSkyIdx, g: yearGroundIdx },
            month: { s: monthSkyIdx, g: monthGroundIdx },
            day: { s: daySkyIdx, g: dayGroundIdx },
            hour: { s: hourSkyIdx, g: hourGroundIdx }
        };

        // 렌더링 호출
        renderColumn('year', pillars.year, dayMaster);
        renderColumn('month', pillars.month, dayMaster);
        renderColumn('day', pillars.day, dayMaster);
        renderColumn('hour', pillars.hour, dayMaster);

        document.getElementById('resultArea').style.display = 'block';
    }

    // ------------------------------------
    // 상세 로직 함수들
    // ------------------------------------
    function getTenGod(targetWuxing, targetIsYang, dayMaster) {
        const dayWuxing = dayMaster.wuxingIdx;
        const dayIsYang = (dayMaster.yinYang === 0);
        const relation = mod(targetWuxing - dayWuxing, 5);
        const isSameYinYang = (targetIsYang === dayIsYang);
        return TEN_GODS[relation][isSameYinYang ? 0 : 1];
    }

    function get12Unseong(groundIdx, dayMaster) {
        const skyIdx = dayMaster.idx;
        const isYang = (skyIdx % 2 === 0);
        const startPoints = { 0:11, 1:6, 2:2, 3:9, 4:2, 5:9, 6:5, 7:0, 8:8, 9:3 };
        const startIdx = startPoints[skyIdx];
        let offset = isYang ? mod(groundIdx - startIdx, 12) : mod(startIdx - groundIdx, 12);
        return UNSEONG_NAMES[offset];
    }

    function getSinsalAndNoble(skyIdx, groundIdx, dayMaster) {
        let nobles = [];
        let sinsals = [];
        const daySky = dayMaster.idx;

        // 1. 천을귀인
        const nobleMap = {
            0:[1,7], 4:[1,7], 6:[1,7],
            1:[0,8], 5:[0,8],
            2:[11,9], 3:[11,9],
            7:[2,6], 8:[5,3], 9:[5,3]
        };
        if (nobleMap[daySky] && nobleMap[daySky].includes(groundIdx)) nobles.push("천을귀인");

        // 2. 신살 (백호, 괴강, 도화 등)
        if ( (skyIdx===0 && groundIdx===4) || (skyIdx===1 && groundIdx===7) ||
             (skyIdx===2 && groundIdx===10)|| (skyIdx===3 && groundIdx===1) ||
             (skyIdx===4 && groundIdx===4) || (skyIdx===8 && groundIdx===10)||
             (skyIdx===9 && groundIdx===1) ) sinsals.push("백호살");

        if ( (skyIdx===4 && groundIdx===10) || (skyIdx===6 && groundIdx===4) ||
             (skyIdx===6 && groundIdx===10) || (skyIdx===8 && groundIdx===4) ) sinsals.push("괴강살");

        if ([0, 6, 3, 9].includes(groundIdx)) sinsals.push("도화"); 
        if ([2, 8, 5, 11].includes(groundIdx)) sinsals.push("역마");
        if ([4, 10, 1, 7].includes(groundIdx)) sinsals.push("화개");

        return { nobles, sinsals };
    }


    // ------------------------------------
    // 렌더링
    // ------------------------------------
    function renderColumn(prefix, data, dayMaster) {
        const skyInfo = SKY_DATA[data.s];
        const groundInfo = GROUND_DATA[data.g];

        // 1. 천간
        const skyCell = document.getElementById(prefix + 'SkyCell');
        skyCell.innerHTML = `
            <div class="char-box ${WUXING[skyInfo.wuxingIdx].color}">${skyInfo.ch}</div>
            <span class="char-ko">${skyInfo.ko}</span>
        `;

        // 2. 천간 십성 (New Row)
        const skyTenCell = document.getElementById(prefix + 'SkyTen');
        if (prefix === 'day') {
            skyTenCell.innerHTML = '<span class="master-label">본원</span>';
        } else {
            const ten = getTenGod(skyInfo.wuxingIdx, skyInfo.yinYang === 0, dayMaster);
            skyTenCell.innerHTML = `<span class="ten-god-text">${ten}</span>`;
        }

        // 3. 지지
        const groundCell = document.getElementById(prefix + 'GroundCell');
        groundCell.innerHTML = `
            <div class="char-box ${WUXING[groundInfo.wuxingIdx].color}">${groundInfo.ch}</div>
            <span class="char-ko">${groundInfo.ko}</span>
        `;

        // 4. 지지 십성 (New Row)
        const groundTenCell = document.getElementById(prefix + 'GroundTen');
        const groundTen = getTenGod(groundInfo.wuxingIdx, groundInfo.isYang, dayMaster);
        groundTenCell.innerHTML = `<span class="ten-god-text">${groundTen}</span>`;


        // 5. 십이운성
        const unseongCell = document.getElementById(prefix + 'Unseong');
        unseongCell.innerText = get12Unseong(data.g, dayMaster);

        // 6. 신살 & 귀인
        const result = getSinsalAndNoble(data.s, data.g, dayMaster);
        
        const sinsalCell = document.getElementById(prefix + 'Sinsal');
        sinsalCell.innerHTML = result.sinsals.map(s => `<span class="badge badge-sinsal">${s}</span>`).join(' ');

        const nobleCell = document.getElementById(prefix + 'Noble');
        nobleCell.innerHTML = result.nobles.map(n => `<span class="badge badge-noble">${n}</span>`).join(' ');
    }

    window.onload = function() {
        const now = new Date();
        const offset = now.getTimezoneOffset() * 60000;
        document.getElementById('birthDate').value = (new Date(now - offset)).toISOString().slice(0, 16);
    };
</script>

</body>
</html>
